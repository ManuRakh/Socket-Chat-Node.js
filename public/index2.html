<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="utf-8">
    <title>Икс Телеком </title>
    <script src="https://code.jquery.com/jquery-3.0.0.js"></script>
<style>
	p{
		margin: 0;
	}
.card-chat {
	position: fixed;
	top: 15%;
	left:45%;
	width: 320px;
	height: 568px;
	background: #240C27;
	flex-direction: column;

}
.card-chat__header{
padding: 15px;
display: -webkit-flex;
display: -moz-flex;
display: -ms-flex;
display: -o-flex;
display: flex;
-ms-align-items: center;
align-items: center;
}
.card-chat__chat-img {
	width: 31px;
	height:31px;
}

.card-chat__header-text{

	color: #FFFFFF;
	font-size: 22px;
	padding: 5px 55px 5px 10px;

}
.card-chat__close{
	width: 31px;
	height:31px;
}
.card-chat__chat{
	width: 100%;
	height: 380px;
	overflow-y: auto;
}
.chat__messedge{
  background: #301C38;
  border-radius: 5px;
  margin: 5px 15px;
  min-width: 41%;
  max-width: 270px;
  display: inline-block;
}
.admin{
  float: left;
	padding: 0px 0px 12px 0px;
}
.guest{
  float: right;
  padding-bottom: 12px;
}
.chat__messedge .chat__autor {
	font-size: 12px;
	color: #7F6F84;
	display: inline;
	margin-bottom: 4px;
	margin-left: 10px;
	max-width: 80%;
	float: left;

}
.chat__messedge-text{
	font-size: 12px;
	color: #FF8108;
	display: inline-block;
	margin: 4px 0 0 10px;
  max-width:254px;
  word-wrap: break-word;

}
.chat__text-wrapper{
	max-width: 240px;
	float: left;
	clear: left;
}
.card__repeat-img{
	float: right;
	cursor: pointer;

	margin-right: 4px;
}
.chat__request{
	padding: 0 8px; 
  line-height: 1.8em;
font-size: 12px;
color: #7F6F84;
background: #392945;
margin-bottom: 4px;
max-width:254px;
word-wrap: break-word;

}
.chat__info-row{
	background: #301C38;
	width: 100%;
	text-align: center;
	float: left;
	padding: 1px 0 5px 0;
	margin: 5px 0 5px 0;


}
.chat__info-text{
color: #7F6F84;
font-size: 12px;
}

.entry{
	height: 123px;
	background: #392945;
	display: -webkit-flex;
	display: -moz-flex;
	display: -ms-flex;
	display: -o-flex;
	display: flex;
	flex-direction: column;
	justify-content: space-between;

}
.entry img{
	width: auto;

}
.entry__field{
	border: 1px solid #FE3E02;
    border-radius: 5px;
    margin: 0 10px 14px 10px;
 
    padding: 10px;
    display: -webkit-flex;
    display: -moz-flex;
    display: -ms-flex;
    display: -o-flex;
    display: flex;
    justify-content: space-between;
    flex-direction: row;
    -ms-align-items: center;
    align-items: center;
}
.entry__request{
    color: #FF8108;
    font-size: 14px;
    margin: 15px 20px 0px 20px;
    overflow: auto;
    background: #392945;
    outline: none;
    border: 0px;
}
.entry__response{
	width: 195px;
	height: 40px;
	vertical-align: middle;
	font-size: 18px;
    color: #FFFFFF;
    margin-left: 10px;
    background: #392945;
    border: 0px;
    outline: none;
    overflow-y: scroll;
}
.entry__send-img{
	cursor: pointer;
}
</style>
  </head>
  <body>



<div class="card-chat">
    <div class="card-chat__header">
        <svg class="card-chat__chat-img" width="29" height="29" viewBox="0 0 29 29" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M14.5 0C6.49216 0 0 6.49196 0 14.5C0 22.508 6.49216 29 14.5 29C22.508 29 29 22.508 29 14.5C29 6.49196 22.508 0 14.5 0ZM8.65012 20.4185L5.05632 21.3813L6.04013 17.7104C5.36247 16.5455 4.97183 15.1922 4.97183 13.7472C4.97183 9.38993 8.50424 5.85723 12.862 5.85723C17.219 5.85723 20.7517 9.38993 20.7517 13.7472C20.7517 18.1045 17.219 21.6374 12.862 21.6374C11.3126 21.6378 9.86913 21.1899 8.65012 20.4185ZM23.9509 22.9084L20.6818 22.0327C19.5723 22.7342 18.2595 23.1419 16.8507 23.1419C15.8463 23.1419 14.8911 22.9348 14.0233 22.562C18.3797 21.9916 21.7551 18.2576 21.7551 13.7479C21.7551 12.4411 21.469 11.2006 20.9608 10.0816C22.8152 11.3796 24.0282 13.5298 24.0282 15.9643C24.0282 17.2786 23.6731 18.5096 23.0566 19.5694L23.9509 22.9084Z" fill="white"/>
        </svg>
        <span class="card-chat__header-text">Онлайн чат</span>
        <svg class="card-chat__close"  width="31" height="31" viewBox="0 0 31 31" fill="none" xmlns="http://www.w3.org/2000/svg">
            <rect x="0.253272" y="0.253272" width="30.3268" height="30.3268" rx="7.74673" fill="#240C27" stroke="white" stroke-width="0.506544"/>
            <rect x="9.94336" y="8" width="18.619" height="2.42857" rx="1.21429" transform="rotate(45 9.94336 8)" fill="white"/>
            <rect x="8" y="21.1655" width="18.619" height="2.42857" rx="1.21429" transform="rotate(-45 8 21.1655)" fill="white"/>
        </svg>
    </div>
    <div class="card-chat__chat chat">
        
    </div>
    <div class="card__entry-block entry">
        <input maxLength="140" autoComplete="off" type="text" name="response" class="entry__request">
        </input>
        <div class="entry__field">
         <svg class="entry__send-img2" width="30" height="30" viewBox="0 0 30 30" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M15 0C6.72923 0 0 6.72865 0 15C0 23.2713 6.72923 30 15 30C23.2708 30 30 23.2713 30 15C30 6.72865 23.2708 0 15 0ZM22.2115 16.1538H16.1538V22.5C16.1538 23.1369 15.6369 23.6538 15 23.6538C14.3631 23.6538 13.8462 23.1369 13.8462 22.5V16.1538H7.78846C7.15154 16.1538 6.63462 15.6369 6.63462 15C6.63462 14.3631 7.15154 13.8462 7.78846 13.8462H13.8462V8.07692C13.8462 7.44 14.3631 6.92308 15 6.92308C15.6369 6.92308 16.1538 7.44 16.1538 8.07692V13.8462H22.2115C22.8485 13.8462 23.3654 14.3631 23.3654 15C23.3654 15.6369 22.8485 16.1538 22.2115 16.1538Z" fill="url(#paint0_linear)"/>
            <defs>
            <linearGradient id="paint0_linear" x1="15" y1="0" x2="15" y2="30" gradientUnits="userSpaceOnUse">
            <stop stop-color="#FE5702"/>
            <stop offset="1" stop-color="#FF8108"/>
            </linearGradient>
            </defs>
        </svg>
       <input maxLength="140" autoComplete="off" type="text" name="response" class=" entry__response">
        </input >
        <svg class="entry__send-img" width="30" height="30" viewBox="0 0 30 30" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path fill-rule="evenodd" clip-rule="evenodd" d="M15 30C23.2843 30 30 23.2843 30 15C30 6.71573 23.2843 0 15 0C6.71573 0 0 6.71573 0 15C0 23.2843 6.71573 30 15 30ZM25.4715 16.2669L9.21579 22.9316C8.6404 23.1676 8 22.7637 8 22.1645V17.9925C8 17.5744 8.32364 17.2209 8.75706 17.1657L15.3319 16.327C16.3411 16.1982 16.3411 14.8018 15.3319 14.673L8.75706 13.8343C8.32364 13.7791 8 13.4252 8 13.0071V8.83512C8 8.23631 8.6404 7.83237 9.21579 8.06838L25.4715 14.7331C26.1762 15.022 26.1762 15.9781 25.4715 16.2669Z" fill="url(#paint0_linear)"/>
            <defs>
            <linearGradient id="paint0_linear" x1="15" y1="0" x2="15" y2="30" gradientUnits="userSpaceOnUse">
            <stop stop-color="#FE5702"/>
            <stop offset="1" stop-color="#FF8108"/>
            </linearGradient>
            </defs>
          </svg>
        </div>

    </div>
</div>



    </body>
    	<script src="/socket.io/socket.io.js"></script>

<script>



      // socket = io.connect("http://webiraylab.eu-4.evennode.com/");
      socket = io.connect();

     // var author = prompt("What's your name: ","New User") ;
      var author = "Second User";//имя пользователя и его id из бд.
      if (author) {} else{ author = 'Admin'}
      const id = "hjkhjkfsyurhjsfkhfeuhfsjkshfjk"

      var currentRoom = "main_room"+id;



      socket.on('connect', function(){ 
      //вызов событий при подключении 
      socket.emit('ADD_TO_MAIN_ROOM', author, id);  //добавить имя и информацию о юзере
      });
      socket.on('MESS_TO_USER', function(result)
      {
        console.log(result);
      })
function repeat(data) {
$(' .entry__request').val(data)}

socket.on("UPDATE_ROOMS", (val, val2)=>{
  console.log(val, val2)
})
socket.on("TECH-MESSEGE", ()=>{
  console.log("TECH MESSAGE")
})
      socket.on('TO_CHAT_MESS', function(data){
        console.log(data)
        if (data.role == "admin") {
                   $('.chat').append(
                  ` <div class='chat__messedge ${data.role}'>
                      <p class="chat__request">
                       ${data.request}
                     </p>
                  <p class="chat__autor">
                       ${data.author}
                  </p>

                  <svg class="card__repeat-img" onclick="repeat('${data.message}')"   width="10" height="9" viewBox="0 0 10 9" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M9.63478 4.22673L5.6307 0.0144043V2.5275H4.77938C2.13979 2.5275 0 4.58041 0 7.11301V8.44484L0.378052 8.04729C1.66369 6.69596 3.48264 5.92596 5.38965 5.92596H5.63051V8.43906L9.63478 4.22673Z" fill="#FF8108"/>
                  </svg>

                       <div class="chat__text-wrapper">
                      <p class="chat__messedge-text">
                       ${data.message}
                      </p>
                  </div>
              </div> `       
          );
        }  else{     
         $('.chat').append(
            ` <div class='chat__messedge ${data.role}'>
            <p class="chat__request">
                       ${data.request}
            </p>
                  <p class="chat__autor">
                       ${data.author}
                  </p>
                       <div class="chat__text-wrapper">
                      <p class="chat__messedge-text">
                       ${data.message}
                      </p>
                  </div>
              </div> `       
          );
       }
          
        // $(".card__chat").scrollTo(0, document.body.scrollHeight);
        });
        socket.on("GET_ALL_CONVERSATIONS", (arr)=>{
          console.log(arr)
        })
          $('.entry__send-img').click(function(){
        //  запуск события SEND_MESSAGE
       		if ( $(' .entry__response').val() ) 
       				{socket.emit('TO_SERVER_MESS', 
       				{
		              author: author,
		              message:$(' .entry__response').val(),
		              request:$(' .entry__request').val(),
		              time:new Date().toLocaleString(),
		              current_room:currentRoom
		            });

		            message:$(' .entry__response').val('')
		            request:$(' .entry__request').val('')}

       		else{}
     	   });
          $('.entry__send-img2').click(function(){
        //  запуск события SEND_MESSAGE
       		if ( $(' .entry__response').val() ) 
       				{socket.emit('GET_ALL_CONVERSATIONS', 
       				{
		              author: author,
		              message:$(' .entry__response').val(),
		              request:$(' .entry__request').val(),
		              time:new Date().toLocaleString(),
		              current_room:author
		            });

		            message:$(' .entry__response').val('')
		            request:$(' .entry__request').val('')}

       		else{}
     	   });
</script>



    </html>
<!--<div class="chat__info-row">
            <span class="chat__info-text">
              Вам ответит оператор Дмитрий
            </span>
        </div>
        -->